---
title: "プライバシーが気になる人間が、Claude Codeで暗号化ノートアプリを作った話"
emoji: "🔐"
type: "tech"
topics: ["rust", "tauri", "encryption", "claudecode", "privacy"]
published: false
---

## はじめに

常時VPNを使うくらいにはプライバシーが気になる人間です。

もともと「ノートアプリを作りたい」とぼんやり思っていたところに、Claude Codeが使える環境が手に入りました。プログラミングの専門家ではない自分でも、AIの力を借りればちゃんとしたものが作れるかもしれない。せっかく作るなら人の役に立つものにしたい。

でも、ノートアプリは大手がすでに十分な品質のものを出しています。Google Keep、Notion、Apple Notes——普通のニーズはもう満たされている。じゃあ自分が勝負できるニッチはどこだろう？

調べていくうちに「プライバシー」にたどり着きました。

既存のノートアプリの多くは、サーバー側でデータを読める構造になっています。E2E暗号化を謳っているものでも、実装が不透明だったり、クローズドソースだったりする。自分自身がプライバシーを気にする人間だからこそ、「これだ」と思いました。

こうして **Knot** を作り始めました。

## Knotとは

**A knot only you can untie.** ——あなたにしか解けない結び目。

Knotは、ローカルで完結する暗号化ノートアプリです。サーバーなし、クラウドなし、平文がディスクに触れることもありません。

![メインエディタ](https://raw.githubusercontent.com/pher-lab/knot/main/docs/screenshots/main_editor.png)

### 主な特徴

- **二重暗号化**: SQLCipherがデータベース全体を暗号化し、その上でXChaCha20-Poly1305がノート内容を個別に暗号化
- **強力な鍵導出**: Argon2id（メモリ64MB、3イテレーション、4並列レーン）
- **リカバリーキー**: BIP39の12単語ニーモニック。PDFで出力・保管可能
- **Markdownエディタ**: CodeMirror 6ベース。ツールバー、シンタックスハイライト、自動保存
- **Wikiリンク**: `[[ノート名]]` でノート間リンク。存在しないノートはクリックで自動作成
- **全文検索**: 暗号化されたノートを横断検索
- **自動ロック**: 設定可能なアイドルタイムアウト。ロック時に暗号化キーをメモリから消去
- **日本語/英語対応**

### 技術スタック

| レイヤー | 技術 |
|---------|------|
| フロントエンド | React 19, TypeScript, Vite 7, Tailwind CSS 4, Zustand, CodeMirror 6 |
| バックエンド | Rust, Tauri 1.8, SQLCipher, RustCrypto (chacha20poly1305, argon2, hkdf, bip39) |

## 暗号化の設計

ゼロ知識アーキテクチャを目指しました。アプリが知っているのは「暗号化されたデータ」だけで、中身を読める状態は鍵がメモリ上にある間だけです。

```
  パスワード                    リカバリーフレーズ（12単語）
     │                                │
     ▼                                ▼
  Argon2id                      HKDF-SHA256
  (64MB/3/4)                  (ドメイン分離)
     │                                │
     ▼                                ▼
  Master Key                    Recovery KEK
     │                                │
     └──────────────┬─────────────────┘
                    ▼
                   DEK  ← ランダム生成
                    │
              ┌─────┴─────┐
              ▼           ▼
          SQLCipher    XChaCha20-Poly1305
        (DB全体)     (ノート個別)
```

パスワードからArgon2idでMaster Keyを導出し、それでDEK（Data Encryption Key）を復号します。DEKがSQLCipherとノート暗号化の両方に使われます。ロック時にDEKはメモリからゼロクリアされます。

## AI支援開発について

このプロジェクトはClaude Codeの力を大きく借りて開発しました。透明性のために書いておきます。

- **コードの大部分はAIが書いた**: 暗号化モジュール、フロントエンド、テスト、ドキュメント
- **設計判断は人間が行った**: アーキテクチャ、機能の優先順位、セキュリティのトレードオフ
- **全コードを人間がレビューした**: AIの出力をそのまま使ったわけではない
- **AIによるセキュリティレビューも実施**: ただし正式な監査の代替ではない

「AIが書いたコードは信用できるのか？」という疑問はもっともです。だからこそ、コードは全て公開しています。暗号化ライブラリはRustCryptoプロジェクトの実績あるものを使い、独自の暗号アルゴリズムは一切実装していません。

## 正直な限界

現時点ではクローズドアルファ（v0.1.0）です。正直に書いておくべき限界があります。

- **セキュリティ監査を受けていない**: 暗号化の設計はベストプラクティスに従っていますが、第三者によるレビューはまだ行われていません
- **Windowsのみテスト済み**: macOS/Linuxビルドは動くはずですが未検証
- **パフォーマンス**: ノートリストの読み込み時に全ノートを復号するため、数百ノート規模では遅くなる可能性あり
- **同期なし**: 現時点では完全ローカル。暗号化同期は将来のフェーズで予定
- **フロントエンドのメモリ制約**: JavaScriptのメモリモデルの限界上、パスワードや復号内容の確実なゼロクリアは困難

これらのトレードオフの詳細は [DESIGN_DECISIONS.md](https://github.com/pher-lab/knot/blob/main/docs/DESIGN_DECISIONS.md) に記録しています。

## テスト

94テスト（Rust 63 + フロントエンド 31）が全てパスしています。

| カテゴリ | テスト数 | 内容 |
|---------|---------|------|
| 暗号化 | 10 | 暗号化/復号、大きなデータ、改ざん検出 |
| 鍵導出 | 7 | Argon2id、パスワードバリエーション |
| リカバリー | 3 | キー生成・復元 |
| データベース | 6 | SQLCipher、CRUD |
| 統合テスト | 7 | パスワード→暗号化→復号のフルフロー |
| 認証フロー | 18 | 画面遷移、ロック/アンロック |
| ノート操作 | 13 | CRUD、Wikiリンクナビゲーション |

## 試してみたい方へ

GitHubのReleaseページからWindowsインストーラーをダウンロードできます。

https://github.com/pher-lab/knot

**注意**: セキュリティ監査が未実施のため、重要なデータの唯一の保存先としての使用は推奨しません。

バグ報告や機能要望は [GitHub Issues](https://github.com/pher-lab/knot/issues) へ。
セキュリティ上の問題を見つけた場合は、公開前にメールでご連絡ください。

## おわりに

プライバシーが気になる一人の人間が、AIの力を借りて「自分が欲しいもの」を作りました。まだアルファ版ですが、暗号化の設計は堅実だと自負しています。

もし同じようにプライバシーを大切にする方がいれば、試してみてください。そしてコードを見て、おかしなところがあれば教えてください。

プライバシーツールはオープンソースであるべきだと思っています。だからAGPL-3.0で公開しました。
